<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Replacer Tests</title>
<link rel="stylesheet"
	href="https://code.jquery.com/qunit/qunit-2.0.1.css">
<link href="../css/bootstrap.min.css" rel="stylesheet">
<link href="../css/replacer.css" rel="stylesheet">
</head>
<body>
	<h1>Tests unitarios</h1>

	<div id="qunit"></div>
	<div id="qunit-fixture"></div>

	<h1>Resaltado de errores y de sintaxis</h1>

	<h2>Texto original</h2>
	<div id="contentOrig" class="pre"></div>

	<h2>Texto resaltado con errores </h2>
	<div id="contentHighlighted" class="pre"></div>

	<h2>Texto corregido</h2>
	<div id="contentFixed" class="pre"></div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="../js/bootstrap.min.js"></script>
	<script src="../js/string-utils.js"></script>
	<script src="../js/regex.js"></script>
	<script src="../js/replace-utils.js"></script>
	<script src="../js/db-utils.js"></script>

	<script src="https://code.jquery.com/qunit/qunit-2.0.1.js"></script>
	<script src="qunit-tests.js"></script>

	<script type="text/javascript">
		var orig = 'Z\n\n'
			+ 'X\nX\nX\nX\n'
			+ '<!-- Comentario -->\n' + '== Una google cabecera de google ==\n\n'
			+ 'Esto es un <i>ejemplo</i> de [[c√≥digo]] wiki.\n'
			+ 'Un enlace: https://www.google.es a google.'
			+ '\nX\nX\nX\nX'
			+ '\n\nZ';
		var encoded = StringUtils.encodeHtml(orig);
		$('#contentOrig').html(encoded);
		$('#contentFixed').text(orig);

		var misspellings = [{word : 'google', cs : 1, suggestion : 'Google'}];
		var misspellingMatches = ReplaceUtils.findMisspellingMatches(encoded, misspellings);
		var misspelled = ReplaceUtils.replaceMisspellingsWithButtons(encoded, misspellingMatches);
		misspelled = ReplaceUtils.removeParagraphsWithoutMisspellings(misspelled);

		var highlighted = ReplaceUtils.highlightSyntax(misspelled);
		$('#contentHighlighted').html(highlighted);

		// Add event to the misspelling buttons
		$('.miss').click(function() {
			var missId = this.id;
			var idx = missId.split('-')[1];
			var missMatch = misspellingMatches[idx];
			if (missMatch.fixed) {
				$('#' + missId).removeClass('btn-success');
				$('#' + missId).addClass('btn-danger');
				$('#' + missId).html(missMatch.word);
				missMatch.fixed = false;
			} else {
				$('#' + missId).removeClass('btn-danger');
				$('#' + missId).addClass('btn-success');
				$('#' + missId).html(missMatch.fix);
				missMatch.fixed = true;
			}

			// Apply the fixes and show it
			var fixed = ReplaceUtils.replaceFixes(encoded, misspellingMatches);
			var decodedFixed = StringUtils.decodeHtml(fixed);
			$('#contentFixed').text(decodedFixed);
		});

		// Add cool Bootstrap tooltips
		$(function() {
			$('[data-toggle="tooltip"]').tooltip()
		});

		// Retrieve the title of a page with misspellings
		DataBaseUtils.getMisspelledPage(function(title) {
			alert('Page with misspellings: ' + title);
			DataBaseUtils.getPageMisspellings(title, function(misspellings) {
				alert('Misspellings in the page: ' + JSON.stringify(misspellings));
			});
		});
	</script>
</body>
</html>